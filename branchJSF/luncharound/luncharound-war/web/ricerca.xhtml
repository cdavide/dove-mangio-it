<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:f="http://java.sun.com/jsf/core">
    <ui:define name="content" >       
        <center>
            <h:form id="formric">
                <p:fieldset legend="Ricerca" toggleable="true" style="width:500px;"   >
                    <h:selectOneRadio id="scelta" onclick="seleziona('formric')" value="#{ricercaBean.tipo}" >
                        <f:selectItem id="a" itemValue="1" itemLabel="ricerca per indirizzo"  /> 
                        indirizzo:  <h:inputText id="ind" value="#{ricercaBean.indirizzo}"/><br/>
                        <f:selectItem itemValue="2" itemLabel="ottieni la mia posizione" />        
                    </h:selectOneRadio>

                    con distanza massima
                    <h:selectOneMenu id="distanza" value="#{ricercaBean.distanza}">
                        <f:selectItem itemValue="1" itemLabel="1 km"/>
                        <f:selectItem itemValue="2" itemLabel="2 km"/>
                        <f:selectItem itemValue="5" itemLabel="5 km"/>
                        <f:selectItem itemValue="10" itemLabel="10 km"/>
                        <f:selectItem itemValue="15" itemLabel="15 km"/>
                        <f:selectItem itemValue="20" itemLabel="20 km"/>
                    </h:selectOneMenu><br/>

                    <h:selectBooleanCheckbox  id="salva"  value="#{ricercaBean.salva}" >
                    </h:selectBooleanCheckbox>
                    <h:outputText   value="Imposta questo indirizzo come predefinito"/><br/>

                    <p:commandButton  value="Ricerca"  onclick="if(needGeoByAddr()){geoByAddr();}"/>

                    <h:inputHidden   id="lat" value="#{ricercaBean.latitudine}"/>
                    <h:inputHidden id="lon" value="#{ricercaBean.longitudine}"/>
                    <p:commandButton id="sub" update="risultati"  
                                     style="display:none; visibility: hidden;" 
                                     actionListener="#{ricercaBean.submit}">
                    </p:commandButton>

                </p:fieldset>
            </h:form>

            <br></br>


            <h:form id="risultati" > 

                <p:gmap  id="mymap" rendered="#{ricercaBean.noSearch=='false'}"
                         center="#{ricercaBean.latitudine},#{ricercaBean.longitudine}" 
                         draggable="true" zoom="#{ricercaBean.zoom}" 
                         type="HYBRID" 
                         style="width:700px;height:400px;"
                         model="#{ricercaBean.advancedModel}" 
                         overlaySelectListener="#{ricercaBean.onMarkerSelect}">

                    <p:gmapInfoWindow>  
                        <p:outputPanel style="text-align:center;display:block;margin:auto">   
                            <h:outputText value="#{ricercaBean.marker.title}" />
                            <br></br><br></br>
                            <h:outputText value="#{ricercaBean.marker.data}" />


                        </p:outputPanel>   
                    </p:gmapInfoWindow> 

                </p:gmap>


                <br></br>        
                <h:outputText rendered="#{ricercaBean.noSearch=='false' and ricercaBean.zeroResults}"
                              value="Spiacente, non conosco nessun locale a questa distanza dal punto ricercato"
                              style="font-style:inherit"  />


                <p:dataTable rendered="#{ricercaBean.noSearch=='false' and ricercaBean.zeroResults=='false'}"
                             var="ris" value="#{ricercaBean.lista}" rows="2"  style="border:0" rowStyleClass="dtrow"  paginator="true"   
                             paginatorTemplate="{PreviousPageLink} {PageLinks} {NextPageLink}" >

                    <p:column style="width:5%; border: 0">
                        <h:outputText value="#{ris.posizione}"  />
                    </p:column> 

                    <p:column style="width:20%;border: 0">
                        <p:graphicImage width="120px" height="120px" value="/resources/default_loc2.jpg"/>   
                    </p:column>

                    <p:column style="width:20%;border: 0">
                        <h:outputText  value="#{ris.loc.nome}" /> 
                        <br></br><br></br> 
                        <h:outputText value="#{ris.loc.indirizzo}" /> 
                    </p:column>

                    <p:column  style="width:40%;border:0;" >
                        <!--<h:panelGrid columns="2" cellpadding="0" border="0" >-->
                            <h:outputText value="affollamento"/>
                            <p:rating  value="#{ris.aff}" stars="5" disabled="true"/><br></br>
                            <h:outputText value="velocità"/>
                            <p:rating value="#{ris.vel}" stars="5" disabled="true"/><br></br>
                            <h:outputText value="cortesia"/>
                            <p:rating value="#{ris.cor}" stars="5" disabled="true"/><br></br>
                            <h:outputText value="qualità"/>
                            <p:rating  value="#{ris.qual}" stars="5" disabled="true"/><br></br>
                            <h:outputText value="quantità"/>
                            <p:rating value="#{ris.quan}" stars="5" disabled="true"/><br></br>
                            <h:outputText value="pulizia"/>
                            <p:rating  value="#{ris.pul}" stars="5" disabled="true"/><br></br>
                        <!--</h:panelGrid>-->
                    </p:column>

                    <p:column style="width:20%;border: 0; text-align: center " >
                        <h:commandLink id="kinglink"   action="#{ricercaBean.visualizzaLocale}" >
                            <f:param name="idLocale" value="#{ris.loc.id}" />
                            <p:graphicImage  value="/resources/menu.gif"/>   
                            <br></br>
                            <h:outputText value="Visualizza il menu' e i dettagli del locale"></h:outputText>
                        </h:commandLink>
                    </p:column>

                </p:dataTable>
            </h:form>
        </center>

    </ui:define>

</ui:composition>
