<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:p="http://primefaces.prime.com.tr/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="content">
        <f:view contentType="text/html">

            <h:form id="visual_loc">
                <h1>
                        <h:outputText value="#{visualizzaLocale.locale.nome}" style="text-align: left;"/>
                     
                </h1>
                   <h:outputText escape="false" value="Condividi questo locale su: #{visualizzaLocale.twitLocale} #{visualizzaLocale.facebook}" style="align:right;"/>
                <p:accordionPanel tabChangeListener="mymap.checkResize()" activeIndex="1">
                    <p:tab   title="Dove siamo" >
                        <f:view contentType="text/html">
                            <p:gmap center="#{mapBean.centerLat},#{mapBean.centerLong}"  draggable="true" zoom="16" type="HYBRID" 
                                    style="width:100%;height:400px"
                                    model="#{mapBean.simpleModel}"  widgetVar="mymap"/>
                        </f:view>
                        <h:outputText value="#{visualizzaLocale.locale.indirizzo}"/>
                        
                    </p:tab>
                    <p:tab title="Descrizione Locale">
                        <h:outputText value="#{visualizzaLocale.locale.descrizione}"/>
                    </p:tab>
                    <p:tab title="Menu del Giorno (#{visualizzaLocale.validita})">  
                        <p:dataTable rendered="#{visualizzaLocale.menu.size() > 0}" id="menu_tbl" value="#{visualizzaLocale.menu}" var="piatto" >
                            <p:column style="text-align: left;width:100%;" headerText="Nome Piatto" >
                                    <h:outputText  value="#{piatto.nome}" />
                            </p:column>
                             <p:column headerText="Carne" style="width:100%">
                                 <h:selectBooleanCheckbox disabled="true"  value="#{piatto.carne}" />
                            </p:column>
                             <p:column headerText="Pesce" style="width:100%">
                                 <h:selectBooleanCheckbox disabled="true"  value="#{piatto.pesce}" />
                            </p:column>
                             <p:column headerText="Celiac" style="width:100%">
                                 <h:selectBooleanCheckbox disabled="true"  value="#{piatto.celiaco}" />
                            </p:column>
                             <p:column headerText="Vegan" style="width:100%">
                                 <h:selectBooleanCheckbox disabled="true"  value="#{piatto.vegano}" />
                            </p:column>
                             <p:column headerText="Veget" style="width:100%">
                                 <h:selectBooleanCheckbox disabled="true"  value="#{piatto.vegetariano}" />
                            </p:column>
                            <p:column headerText="Prezzo" style="width:100%">
                                <h:outputText  value="#{piatto.prezzo}" />
                            </p:column>
                        </p:dataTable>
                        <h:outputText rendered="#{visualizzaLocale.menu.size() == 0}" value="Non sono presenti piatti nel menu"/>
                    </p:tab>

                    <p:tab title="Combinazioni e Offerte de locale">  
                        <p:dataTable rendered="#{visualizzaLocale.offerte.size() > 0}" id="menu_tb2" value="#{visualizzaLocale.offerte}" var="piattocombo" >
                            <p:column style="text-align: left;width:100%;" headerText="Descrizione Combinazione" >
                                    <h:outputText  value="#{piattocombo.descr}" />
                            </p:column>
                            <p:column headerText="Prezzo" style="width:100%">
                                    <h:outputText  value="#{piattocombo.prezzo}" />
                            </p:column>
                        </p:dataTable>
                        <h:outputText rendered="#{visualizzaLocale.menu.size() == 0}" value="Non sono presenti piatti nel menu"/>
                    </p:tab>

                    <p:tab title="Valutazione Utenti">  
                        <h:panelGrid id="displayRatings"  columns="12" cellpadding="5">
                            <h:outputLabel for="v" value="Velocità:" /><br/>
                            <p:rating id="v" value="#{ratingController.vel}" stars="5" disabled="true"/><br/>
                            <h:outputLabel for="cc" value="Cortesia:" /><br/>
                            <p:rating id ="cc" value="#{ratingController.cort}" disabled="true" stars="5"/><br/>
                            <h:outputLabel for="af" value="Affollamento:" /><br/>
                            <p:rating id="af" value="#{ratingController.aff}" disabled="true" stars="5"/><br/>
                            <h:outputLabel for="co" value="Qualità" /><br/>
                            <p:rating id="co" value="#{ratingController.qual}" disabled="true" stars="5"/><br/>
                            <h:outputLabel for="qq" value="Quantità" /><br/>
                            <p:rating id="qq" value="#{ratingController.quan}" disabled="true" stars="5"/><br/>
                            <h:outputLabel for="pp" value="Pulizia" /><br/>
                            <p:rating id="pp" value="#{ratingController.pul}" disabled="true" stars="5"/><br/>
                        </h:panelGrid>
                    </p:tab>
                    
                    <c:if test="#{!visualizzaLocale.gestore &amp;&amp; visualizzaLocale.loggedIn}">
                        <p:tab title="Valuta locale">  
                            <h:panelGrid columns="12" cellpadding="2">
                                <h:outputLabel value="Velocità:" for="vel"/><br/>
                                <p:rating id="vel" value="#{ratingController.velocita}" /><br/>
                                <h:outputLabel for="cor" value="Cortesia:" /><br/>
                                <p:rating id="cor" value="#{ratingController.cortesia}" stars="5"/><br/>
                                <h:outputLabel for="aff" value="Affollamento:" /><br/>
                                <p:rating id="aff" value="#{ratingController.affollamento}" stars="5"/><br/>
                                <h:outputLabel for="qual" value="Qualità" /><br/>
                                <p:rating id="qual" value="#{ratingController.qualita}" stars="5"/><br/>
                                <h:outputLabel for="quant" value="Quantità" /><br/>
                                <p:rating id="quant" value="#{ratingController.quantita}" stars="5"/><br/>
                                <h:outputLabel for="pul" value="Pulizia" /><br/>
                                <p:rating id="pul" value="#{ratingController.pulizia}" stars="5"/><br/>
                            </h:panelGrid>

                            <p:commandButton ajax="false" value="Vota" update="displayRatings  growl visual_loc" style="margin:5px" 
                                             action="#{ratingController.submitRating()}"/>
                        </p:tab>
                    </c:if>
                    <c:if test="#{visualizzaLocale.gestore}">
                        <p:tab title="Statistiche gradimento">
                            <p:graphicImage value="#{visualizzaLocale.chart}" />
                        </p:tab>
                    </c:if>
                    <p:tab title="News Locale" id="newsForm">
                            <p:dataList value="#{newsBean.news}" var="news"
                                    paginator="true" rows="10" effectSpeed="fast"
                                    paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink}">

                                    <p:column>
                                            <p:commandLink update="newsDetail" oncomplete="newsDialog.show()" title="View Detail">
                                            <p:graphicImage value="/resources/news_logo.png"/> 
                                            <f:setPropertyActionListener value="#{news}" target="#{newsBean.selectedNews}" />
                                    </p:commandLink>

                                    <h:outputText value="#{news.titolo}, #{news.getDataInizioShort()}" style="margin-left:10px" />

                                    </p:column>
                            </p:dataList>

                    </p:tab>
                    <p:tab title="Eventi Locale" id="eventForm">
                            <p:dataList value="#{eventBean.eventi}" var="evento"
                                    paginator="true" rows="10" effectSpeed="fast"
                                    paginatorTemplate="{PreviousPageLink} {CurrentPageReport} {NextPageLink}">

                                    <p:column>
                                        <p:commandLink update="eventDetail" oncomplete="eventDialog.show()" title="View Detail">
                                            <p:graphicImage value="/resources/calendar.jpg"/> 
                                            <f:setPropertyActionListener value="#{evento}" target="#{eventBean.selectedEvent}" />
                                        </p:commandLink>

                                        <h:outputText value="#{evento.titolo}, #{evento.getDataInizioShort()}" style="margin-left:10px" />

                                    </p:column>
                            </p:dataList>

                    </p:tab>
                </p:accordionPanel>
            </h:form>
        </f:view>
        <p:dialog header="News Detail" widgetVar="newsDialog" width="300" height="400" modal="true">
            <h:form prependId="false">
                        <p:outputPanel id="newsDetail" style="text-align:center;" layout="block">

                                <p:graphicImage value="/resources/ic2.png"/>

                                <h:panelGrid  columns="2" cellpadding="5">
                                        <h:outputLabel for="titolo" value="Titolo: " />
                                        <h:outputText id="titoloNews" value="#{newsBean.selectedNews.titolo}" />

                                        <h:outputLabel for="dataInizio" value="Data inizio: " />
                                        <h:outputText id="dataInNews" value="#{newsBean.selectedNews.getDataInizioShort()}" />

                                        <h:outputLabel for="descrizione" value="Descrizione: " />
                                        <h:outputText id="descrNews" value="#{newsBean.selectedNews.descr}"/>

                                        <p:commandLink   id="openLocNews"  action="#{newsBean.visualizzaLocale}"  ajax="false" >
                                            <f:param name="idLocale" value="#{newsBean.selectedNews.idLocale}" />
                                            <h:outputText value="Visualizza il locale"></h:outputText>
                                        </p:commandLink>
                                </h:panelGrid>
                        </p:outputPanel>
                </h:form>
        </p:dialog>
        <p:dialog header="Event Detail" widgetVar="eventDialog" width="300" height="400" modal="true">
            <h:form prependId="false">
                <p:outputPanel id="eventDetail" style="text-align:center;" layout="block">

                        <p:graphicImage value="/resources/ic2.png"/>

                        <h:panelGrid  columns="2" cellpadding="5">
                                <h:outputLabel for="titolo" value="Titolo: " />
                                <h:outputText id="titoloEv" value="#{eventBean.selectedEvent.titolo}" />

                                <h:outputLabel for="dataInizio" value="Data inizio: " />
                                <h:outputText id="dataInEv" value="#{eventBean.selectedEvent.getDataInizioShort()}" />

                                <h:outputLabel for="dataFine" value="Data fine: " />
                                <h:outputText id="dataFinEv" value="#{eventBean.selectedEvent.getDataInizioShort()}" />

                                <h:outputLabel for="descrizione" value="Descrizione: " />
                                <h:outputText id="descrEv" value="#{eventBean.selectedEvent.descr}"/>

                                <p:commandLink   id="openLocEv"  action="#{eventBean.visualizzaLocale}"  ajax="false" >
                                    <f:param name="idLocale" value="#{eventBean.selectedEvent.idLocale}" />
                                    <h:outputText value="Visualizza il locale"></h:outputText>
                                </p:commandLink>
                        </h:panelGrid>
                </p:outputPanel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
